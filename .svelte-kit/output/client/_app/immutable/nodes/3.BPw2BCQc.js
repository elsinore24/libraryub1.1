import{L as Te,Z as ce,_ as ue,s as ee,n as O,d as g,$ as fe,i as A,b as k,l as d,c as M,e as T,g as j,h as D,j as $,a0 as Le,r as oe,a as Se,y as f,q as P,m as F,f as je,t as $e,M as R,u as de,o as Ce,p as he,a1 as Ye,z as Xe}from"../chunks/Dc1BERz9.js";import{n as Ze,l as Fe,S as te,i as se,t as L,f as N,a as q,g as W,c as x,h as He,d as G,m as U,e as J,b as K}from"../chunks/CFoqiGzc.js";import{e as ne,u as qe,d as Ae}from"../chunks/_RYpd6Br.js";import{w as Re}from"../chunks/BUT90LOb.js";import{S as X}from"../chunks/DVKMQDi8.js";import{e as Be,a as Ne}from"../chunks/DVNiFOi7.js";import{b as Pe}from"../chunks/D32n8VTX.js";const Ge=!1,It=Object.freeze(Object.defineProperty({__proto__:null,ssr:Ge},Symbol.toStringTag,{value:"Module"}));function Oe(i){const e=i-1;return e*e*e+1}function Q(i,{delay:e=0,duration:t=400,easing:s=Te}={}){const l=+getComputedStyle(i).opacity;return{delay:e,duration:t,easing:s,css:r=>`opacity: ${r*l}`}}function ae(i,{delay:e=0,duration:t=400,easing:s=Oe,x:l=0,y:r=0,opacity:n=0}={}){const c=getComputedStyle(i),o=+c.opacity,a=c.transform==="none"?"":c.transform,u=o*(1-n),[m,_]=ce(l),[h,p]=ce(r);return{delay:e,duration:t,easing:s,css:(E,S)=>`
			transform: ${a} translate(${(1-E)*m}${_}, ${(1-E)*h}${p});
			opacity: ${o-u*S}`}}function ve(i){return Object.prototype.toString.call(i)==="[object Date]"}function ie(i,e){if(i===e||i!==i)return()=>i;const t=typeof i;if(t!==typeof e||Array.isArray(i)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(i)){const s=e.map((l,r)=>ie(i[r],l));return l=>s.map(r=>r(l))}if(t==="object"){if(!i||!e)throw new Error("Object cannot be null");if(ve(i)&&ve(e)){i=i.getTime(),e=e.getTime();const r=e-i;return n=>new Date(i+n*r)}const s=Object.keys(e),l={};return s.forEach(r=>{l[r]=ie(i[r],e[r])}),r=>{const n={};return s.forEach(c=>{n[c]=l[c](r)}),n}}if(t==="number"){const s=e-i;return l=>i+l*s}throw new Error(`Cannot interpolate ${t} values`)}function Ue(i,e={}){const t=Re(i);let s,l=i;function r(n,c){if(i==null)return t.set(i=n),Promise.resolve();l=n;let o=s,a=!1,{delay:u=0,duration:m=400,easing:_=Te,interpolate:h=ie}=ue(ue({},e),c);if(m===0)return o&&(o.abort(),o=null),t.set(i=l),Promise.resolve();const p=Ze()+u;let E;return s=Fe(S=>{if(S<p)return!0;a||(E=h(i,n),typeof m=="function"&&(m=m(i,n)),a=!0),o&&(o.abort(),o=null);const C=S-p;return C>m?(t.set(i=n),!1):(t.set(i=E(_(C/m))),!0)}),s.promise}return{set:r,update:(n,c)=>r(n(l,i),c),subscribe:t.subscribe}}function me(i,e,t){const s=i.slice();return s[19]=e[t],s}function pe(i,e){let t,s,l='<div class="spine-line svelte-lty0mq"></div>',r,n,c,o=e[19].title+"",a,u,m,_,h,p,E,S,C;function B(...v){return e[9](e[19],...v)}function V(...v){return e[10](e[19],...v)}function w(...v){return e[11](e[19],...v)}function b(...v){return e[12](e[19],...v)}return{key:i,first:null,c(){t=D("div"),s=D("div"),s.innerHTML=l,r=$(),n=D("div"),c=D("span"),a=$e(o),u=$(),m=D("div"),_=$(),this.h()},l(v){t=M(v,"DIV",{class:!0,style:!0,draggable:!0,role:!0,"aria-label":!0,"aria-grabbed":!0});var y=T(t);s=M(y,"DIV",{class:!0,"data-svelte-h":!0}),F(s)!=="svelte-xq6ivu"&&(s.innerHTML=l),r=j(y),n=M(y,"DIV",{class:!0});var I=T(n);c=M(I,"SPAN",{class:!0});var z=T(c);a=je(z,o),z.forEach(g),I.forEach(g),u=j(y),m=M(y,"DIV",{class:!0}),T(m).forEach(g),_=j(y),y.forEach(g),this.h()},h(){d(s,"class","book-spine svelte-lty0mq"),d(c,"class","book-title svelte-lty0mq"),d(n,"class","book-content svelte-lty0mq"),d(m,"class","book-edge svelte-lty0mq"),d(t,"class","book-item svelte-lty0mq"),f(t,"--book-color",e[19].color),f(t,"--book-dark",_e(e[19].color)),f(t,"--text-color",le(e[19].color).l>50?"#000":"#fff"),d(t,"draggable",h=!e[1]),d(t,"role",Ke),d(t,"aria-label",p=`${ge}: ${e[19].title}`),d(t,"aria-grabbed",E=!e[1]),this.first=t},m(v,y){A(v,t,y),k(t,s),k(t,r),k(t,n),k(n,c),k(c,a),k(t,u),k(t,m),k(t,_),S||(C=[P(t,"dragstart",B),P(t,"dragend",e[4]),P(t,"dragover",Qe),P(t,"drop",V),P(t,"touchstart",w),P(t,"touchmove",e[7]),P(t,"touchend",b)],S=!0)},p(v,y){e=v,y&1&&o!==(o=e[19].title+"")&&Se(a,o),y&1&&f(t,"--book-color",e[19].color),y&1&&f(t,"--book-dark",_e(e[19].color)),y&1&&f(t,"--text-color",le(e[19].color).l>50?"#000":"#fff"),y&2&&h!==(h=!e[1])&&d(t,"draggable",h),y&1&&p!==(p=`${ge}: ${e[19].title}`)&&d(t,"aria-label",p),y&2&&E!==(E=!e[1])&&d(t,"aria-grabbed",E)},d(v){v&&g(t),S=!1,oe(C)}}}function be(i){let e,t='<span class="text-accent animate-pulse">The books reveal their secret...</span>',s;return{c(){e=D("div"),e.innerHTML=t,this.h()},l(l){e=M(l,"DIV",{class:!0,"data-svelte-h":!0}),F(e)!=="svelte-1jfsuvx"&&(e.innerHTML=t),this.h()},h(){d(e,"class","success-message svelte-lty0mq")},m(l,r){A(l,e,r)},i(l){l&&(s||R(()=>{s=N(e,ae,{y:20,duration:800}),s.start()}))},o:O,d(l){l&&g(e)}}}function Je(i){let e,t,s=[],l=new Map,r,n=ne(i[0]);const c=a=>a[19].id;for(let a=0;a<n.length;a+=1){let u=me(i,n,a),m=c(u);l.set(m,s[a]=pe(m,u))}let o=i[2]&&be();return{c(){e=D("div"),t=D("div");for(let a=0;a<s.length;a+=1)s[a].c();r=$(),o&&o.c(),this.h()},l(a){e=M(a,"DIV",{class:!0});var u=T(e);t=M(u,"DIV",{class:!0,role:!0,"aria-label":!0});var m=T(t);for(let _=0;_<s.length;_+=1)s[_].l(m);m.forEach(g),r=j(u),o&&o.l(u),u.forEach(g),this.h()},h(){d(t,"class","book-grid svelte-lty0mq"),d(t,"role","list"),d(t,"aria-label","Draggable book list"),d(e,"class","puzzle-board svelte-lty0mq"),fe(e,"disabled",i[1])},m(a,u){A(a,e,u),k(e,t);for(let m=0;m<s.length;m+=1)s[m]&&s[m].m(t,null);k(e,r),o&&o.m(e,null)},p(a,[u]){u&507&&(n=ne(a[0]),s=qe(s,u,c,1,a,n,l,t,Ae,pe,null,me)),a[2]?o?u&4&&L(o,1):(o=be(),o.c(),L(o,1),o.m(e,null)):o&&(o.d(1),o=null),u&2&&fe(e,"disabled",a[1])},i(a){L(o)},o:O,d(a){a&&g(e);for(let u=0;u<s.length;u+=1)s[u].d();o&&o.d()}}}const Ke="listitem",ge="Draggable book item";function Qe(i){i.preventDefault()}function le(i){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);if(!e)return{h:0,s:0,l:0};const t=parseInt(e[1],16)/255,s=parseInt(e[2],16)/255,l=parseInt(e[3],16)/255,r=Math.max(t,s,l),n=Math.min(t,s,l),c=(r+n)/2;let o,a;if(r===n)o=a=0;else{const u=r-n;switch(a=c>.5?u/(2-r-n):u/(r+n),r){case t:o=(s-l)/u+(s<l?6:0);break;case s:o=(l-t)/u+2;break;case l:o=(t-s)/u+4;break;default:o=0}o/=6}return{h:Math.round(o*360),s:Math.round(a*100),l:Math.round(c*100)}}function _e(i){const e=le(i);return`hsl(${e.h}, ${e.s}%, ${Math.max(0,e.l-20)}%)`}function We(i,e,t){const s=Le();let{books:l=[]}=e,{disabled:r=!1}=e,n=null,c=!1;Ue(0,{duration:300,easing:Oe});let o=null;function a(b,v){r||(n=v,X.playEffect("book-drag.mp3",{volume:.3}),b.target instanceof HTMLElement&&(b.target.style.opacity="0.7",b.target.classList.add("dragging")))}function u(b){r||(n=null,b.target instanceof HTMLElement&&(b.target.style.opacity="1",b.target.classList.remove("dragging")))}function m(b,v){b.preventDefault(),!(r||n===null)&&E(n,v)}function _(b,v){r||(b.preventDefault(),o=v,X.playEffect("book-drag.mp3",{volume:.3}),b.target instanceof HTMLElement&&b.target.classList.add("touching"))}function h(b){r||o===null||b.preventDefault()}function p(b,v){r||o===null||(b.preventDefault(),b.target instanceof HTMLElement&&b.target.classList.remove("touching"),o!==v&&E(o,v),o=null)}function E(b,v){const y=l.findIndex(Y=>Y.id===b),I=l.findIndex(Y=>Y.id===v);if(y===-1||I===-1)return;const z=[...l];[z[y],z[I]]=[z[I],z[y]],t(0,l=z),X.playEffect("book-place.mp3",{volume:.4}),S()}function S(){[...l].every((v,y)=>{if(y===0)return!0;const I=le(v.color),z=le(l[y-1].color);return I.l>=z.l})&&!c&&(t(2,c=!0),s("solve"))}const C=(b,v)=>a(v,b.id),B=(b,v)=>m(v,b.id),V=(b,v)=>_(v,b.id),w=(b,v)=>p(v,b.id);return i.$$set=b=>{"books"in b&&t(0,l=b.books),"disabled"in b&&t(1,r=b.disabled)},[l,r,c,a,u,m,_,h,p,C,B,V,w]}class xe extends te{constructor(e){super(),se(this,e,We,Je,ee,{books:0,disabled:1})}}function ke(i,e,t){const s=i.slice();return s[2]=e[t],s[4]=t,s}function ye(i,e){let t,s,l,r,n,c,o,a,u,m=e[2].title+"",_,h,p,E,S,C;return{key:i,first:null,c(){t=D("div"),s=D("div"),l=D("div"),r=$(),n=D("div"),c=D("div"),o=$(),a=D("div"),u=D("span"),_=$e(m),h=$(),p=D("div"),E=$(),S=D("div"),C=$(),this.h()},l(B){t=M(B,"DIV",{class:!0,style:!0});var V=T(t);s=M(V,"DIV",{class:!0});var w=T(s);l=M(w,"DIV",{class:!0}),T(l).forEach(g),r=j(w),n=M(w,"DIV",{class:!0,style:!0});var b=T(n);c=M(b,"DIV",{class:!0}),T(c).forEach(g),b.forEach(g),o=j(w),a=M(w,"DIV",{class:!0,style:!0});var v=T(a);u=M(v,"SPAN",{class:!0});var y=T(u);_=je(y,m),y.forEach(g),v.forEach(g),h=j(w),p=M(w,"DIV",{class:!0,style:!0}),T(p).forEach(g),E=j(w),S=M(w,"DIV",{class:!0}),T(S).forEach(g),w.forEach(g),C=j(V),V.forEach(g),this.h()},h(){d(l,"class","book-pages svelte-1us0k7j"),d(c,"class","spine-detail svelte-1us0k7j"),d(n,"class","book-spine svelte-1us0k7j"),f(n,"background-color",e[2].color),d(u,"class","book-title svelte-1us0k7j"),d(a,"class","book-cover front svelte-1us0k7j"),f(a,"background-color",e[2].color),d(p,"class","book-cover back svelte-1us0k7j"),f(p,"background-color",e[2].color),d(S,"class","book-edge svelte-1us0k7j"),d(s,"class","book-model svelte-1us0k7j"),d(t,"class","flying-book svelte-1us0k7j"),f(t,"--start-x",e[1][e[4]].startX+"vw"),f(t,"--start-y",e[1][e[4]].startY+"vh"),f(t,"--start-z",e[1][e[4]].startZ+"px"),f(t,"--end-x",e[1][e[4]].endX+"vw"),f(t,"--end-y",e[1][e[4]].endY+"vh"),f(t,"--end-z",e[1][e[4]].endZ+"px"),f(t,"--book-scale",e[1][e[4]].scale),f(t,"--rotation-speed",e[1][e[4]].rotationSpeed+"s"),f(t,"--motion-duration",e[1][e[4]].duration+"s"),f(t,"--motion-delay",e[1][e[4]].delay+"s"),f(t,"--rotation-x",e[1][e[4]].rotationX+"deg"),f(t,"--rotation-z",e[1][e[4]].rotationZ+"deg"),f(t,"--page-color",e[1][e[4]].pageColor),f(t,"animation-duration","var(--motion-duration)"),f(t,"animation-delay","var(--motion-delay)"),this.first=t},m(B,V){A(B,t,V),k(t,s),k(s,l),k(s,r),k(s,n),k(n,c),k(s,o),k(s,a),k(a,u),k(u,_),k(s,h),k(s,p),k(s,E),k(s,S),k(t,C)},p(B,V){e=B,V&1&&f(n,"background-color",e[2].color),V&1&&m!==(m=e[2].title+"")&&Se(_,m),V&1&&f(a,"background-color",e[2].color),V&1&&f(p,"background-color",e[2].color),V&1&&f(t,"--start-x",e[1][e[4]].startX+"vw"),V&1&&f(t,"--start-y",e[1][e[4]].startY+"vh"),V&1&&f(t,"--start-z",e[1][e[4]].startZ+"px"),V&1&&f(t,"--end-x",e[1][e[4]].endX+"vw"),V&1&&f(t,"--end-y",e[1][e[4]].endY+"vh"),V&1&&f(t,"--end-z",e[1][e[4]].endZ+"px"),V&1&&f(t,"--book-scale",e[1][e[4]].scale),V&1&&f(t,"--rotation-speed",e[1][e[4]].rotationSpeed+"s"),V&1&&f(t,"--motion-duration",e[1][e[4]].duration+"s"),V&1&&f(t,"--motion-delay",e[1][e[4]].delay+"s"),V&1&&f(t,"--rotation-x",e[1][e[4]].rotationX+"deg"),V&1&&f(t,"--rotation-z",e[1][e[4]].rotationZ+"deg"),V&1&&f(t,"--page-color",e[1][e[4]].pageColor)},d(B){B&&g(t)}}}function et(i){let e,t,s,l=[],r=new Map,n=ne(i[0]);const c=o=>o[2].id;for(let o=0;o<n.length;o+=1){let a=ke(i,n,o),u=c(a);r.set(u,l[o]=ye(u,a))}return{c(){e=D("div"),t=D("div"),s=$();for(let o=0;o<l.length;o+=1)l[o].c();this.h()},l(o){e=M(o,"DIV",{class:!0,"aria-hidden":!0});var a=T(e);t=M(a,"DIV",{class:!0}),T(t).forEach(g),s=j(a);for(let u=0;u<l.length;u+=1)l[u].l(a);a.forEach(g),this.h()},h(){d(t,"class","dust-particles svelte-1us0k7j"),d(e,"class","book-space svelte-1us0k7j"),d(e,"aria-hidden","true")},m(o,a){A(o,e,a),k(e,t),k(e,s);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(e,null)},p(o,[a]){a&3&&(n=ne(o[0]),l=qe(l,a,c,1,o,n,r,e,Ae,ye,null,ke))},i:O,o:O,d(o){o&&g(e);for(let a=0;a<l.length;a+=1)l[a].d()}}}function tt(i,e,t){let{books:s=[]}=e;const l=s.map(()=>{const r=Math.random()*100,n=Math.random()*100;let c=Math.random()*100,o=Math.random()*100;for(;Math.abs(c-r)<50&&Math.abs(o-n)<50;)c=Math.random()*100,o=Math.random()*100;return{startX:r,startY:n,endX:c,endY:o,startZ:-50+Math.random()*100,endZ:-50+Math.random()*100,scale:.4+Math.random()*.3,rotationSpeed:15+Math.random()*25,duration:15+Math.random()*30,delay:Math.random()*10,rotationX:Math.random()*20-10,rotationZ:Math.random()*20-10,pageColor:`hsl(${30+Math.random()*20}, ${70+Math.random()*20}%, ${80+Math.random()*15}%)`}});return i.$$set=r=>{"books"in r&&t(0,s=r.books)},[s,l]}class st extends te{constructor(e){super(),se(this,e,tt,et,ee,{books:0})}}function Ee(i){let e,t,s,l,r;function n(a,u){return a[1]?lt:nt}let c=n(i),o=c(i);return{c(){e=D("div"),t=D("div"),o.c(),this.h()},l(a){e=M(a,"DIV",{class:!0});var u=T(e);t=M(u,"DIV",{class:!0});var m=T(t);o.l(m),m.forEach(g),u.forEach(g),this.h()},h(){d(t,"class","compartment-interior svelte-177ue9m"),d(e,"class","secret-compartment svelte-177ue9m")},m(a,u){A(a,e,u),k(e,t),o.m(t,null),r=!0},p(a,u){c===(c=n(a))&&o?o.p(a,u):(o.d(1),o=c(a),o&&(o.c(),o.m(t,null)))},i(a){r||(a&&R(()=>{r&&(l&&l.end(1),s=N(e,ae,{y:50,duration:800}),s.start())}),r=!0)},o(a){s&&s.invalidate(),a&&(l=He(e,Q,{duration:300})),r=!1},d(a){a&&g(e),o.d(),a&&l&&l.end()}}}function lt(i){let e,t='<span class="text-sm text-gray-400">You collected the evidence</span>';return{c(){e=D("div"),e.innerHTML=t,this.h()},l(s){e=M(s,"DIV",{class:!0,"data-svelte-h":!0}),F(e)!=="svelte-1aee23f"&&(e.innerHTML=t),this.h()},h(){d(e,"class","empty-compartment svelte-177ue9m")},m(s,l){A(s,e,l)},p:O,d(s){s&&g(e)}}}function nt(i){let e,t,s,l,r;return{c(){e=D("div"),t=D("img"),this.h()},l(n){e=M(n,"DIV",{class:!0,tabindex:!0,role:!0,"aria-label":!0});var c=T(e);t=M(c,"IMG",{src:!0,alt:!0,class:!0}),c.forEach(g),this.h()},h(){he(t.src,s=i[2])||d(t,"src",s),d(t,"alt","A torn page with poisonous mushroom illustrations"),d(t,"class","clue-image svelte-177ue9m"),d(e,"class","clue-item svelte-177ue9m"),d(e,"tabindex","0"),d(e,"role","button"),d(e,"aria-label","Examine mysterious page")},m(n,c){A(n,e,c),k(e,t),l||(r=[P(t,"error",i[3]),P(e,"click",i[4]),P(e,"keydown",i[6])],l=!0)},p(n,c){c&4&&!he(t.src,s=n[2])&&d(t,"src",s)},d(n){n&&g(e),l=!1,oe(r)}}}function rt(i){let e,t=i[0]&&Ee(i);return{c(){t&&t.c(),e=de()},l(s){t&&t.l(s),e=de()},m(s,l){t&&t.m(s,l),A(s,e,l)},p(s,[l]){s[0]?t?(t.p(s,l),l&1&&L(t,1)):(t=Ee(s),t.c(),L(t,1),t.m(e.parentNode,e)):t&&(W(),q(t,1,1,()=>{t=null}),x())},i(s){L(t)},o(s){q(t)},d(s){s&&g(e),t&&t.d(s)}}}function it(i,e,t){let{visible:s=!1}=e,{clueId:l="poisoned-page"}=e;const r=Le();let n=!1,c="https://kxmwcpeuiklblpehddkz.supabase.co/storage/v1/object/public/clues//library%20ancient%20manuscript.jpeg";function o(){t(2,c=`${Pe}/images/clues/poisoned-page.png`)}Ce(()=>Be.subscribe(_=>{t(1,n=_.some(h=>h.id===l))}));function a(){n||(t(1,n=!0),X.playEffect("discovery",{volume:.5}),Ne({id:l,description:"A page torn from 'Mortiferous Mushrooms' with notes about a deadly poison recipe. The margins contain handwritten notes about dosage calculations.",image:c}),r("clueFound"))}const u=m=>m.key==="Enter"&&a();return i.$$set=m=>{"visible"in m&&t(0,s=m.visible),"clueId"in m&&t(5,l=m.clueId)},[s,n,c,o,a,l,u]}class ot extends te{constructor(e){super(),se(this,e,it,rt,ee,{visible:0,clueId:5})}}function at(i){let e,t,s,l,r='<div class="candle-light svelte-1lcissr"></div> <div class="ambient-glow svelte-1lcissr"></div>';return{c(){e=D("div"),t=D("div"),s=$(),l=D("div"),l.innerHTML=r,this.h()},l(n){e=M(n,"DIV",{class:!0});var c=T(e);t=M(c,"DIV",{class:!0,style:!0}),T(t).forEach(g),s=j(c),l=M(c,"DIV",{class:!0,"data-svelte-h":!0}),F(l)!=="svelte-bw29di"&&(l.innerHTML=r),c.forEach(g),this.h()},h(){d(t,"class","grain-overlay svelte-1lcissr"),f(t,"--grain-intensity",i[0]),f(t,"--flicker-speed",i[1]+"s"),d(l,"class","lighting-effects svelte-1lcissr"),d(e,"class","visual-effects svelte-1lcissr")},m(n,c){A(n,e,c),k(e,t),k(e,s),k(e,l)},p(n,[c]){c&1&&f(t,"--grain-intensity",n[0]),c&2&&f(t,"--flicker-speed",n[1]+"s")},i:O,o:O,d(n){n&&g(e)}}}function ct(i,e,t){let{intensity:s=.15}=e,{flickerSpeed:l=.2}=e;return i.$$set=r=>{"intensity"in r&&t(0,s=r.intensity),"flickerSpeed"in r&&t(1,l=r.flickerSpeed)},[s,l]}class ut extends te{constructor(e){super(),se(this,e,ct,at,ee,{intensity:0,flickerSpeed:1})}}function ft(i){let e,t,s='<div class="wax svelte-1b8z4yq"></div> <div class="wick svelte-1b8z4yq"></div> <div class="flame svelte-1b8z4yq"><div class="flame-core svelte-1b8z4yq"></div> <div class="flame-outer svelte-1b8z4yq"></div> <div class="glow svelte-1b8z4yq"></div></div>',l;return{c(){e=D("div"),t=D("div"),t.innerHTML=s,this.h()},l(r){e=M(r,"DIV",{class:!0,style:!0});var n=T(e);t=M(n,"DIV",{class:!0,"data-svelte-h":!0}),F(t)!=="svelte-9j5vlj"&&(t.innerHTML=s),n.forEach(g),this.h()},h(){d(t,"class","candle-body svelte-1b8z4yq"),d(e,"class",l="candle "+i[0]+" svelte-1b8z4yq"),f(e,"left",i[1].x+"%"),f(e,"top",i[1].y+"%"),f(e,"--intensity",i[2])},m(r,n){A(r,e,n),k(e,t)},p(r,[n]){n&1&&l!==(l="candle "+r[0]+" svelte-1b8z4yq")&&d(e,"class",l),n&2&&f(e,"left",r[1].x+"%"),n&2&&f(e,"top",r[1].y+"%"),n&4&&f(e,"--intensity",r[2])},i:O,o:O,d(r){r&&g(e)}}}function dt(i,e,t){let{size:s="medium"}=e,{position:l={x:50,y:50}}=e,{intensity:r=1}=e;return i.$$set=n=>{"size"in n&&t(0,s=n.size),"position"in n&&t(1,l=n.position),"intensity"in n&&t(2,r=n.intensity)},[s,l,r]}class re extends te{constructor(e){super(),se(this,e,dt,ft,ee,{size:0,position:1,intensity:2})}}function Me(i){let e,t;return e=new st({props:{books:i[8]}}),{c(){K(e.$$.fragment)},l(s){J(e.$$.fragment,s)},m(s,l){U(e,s,l),t=!0},p:O,i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){q(e.$$.fragment,s),t=!1},d(s){G(e,s)}}}function De(i){let e;return{c(){e=D("div"),this.h()},l(t){e=M(t,"DIV",{class:!0,style:!0}),T(e).forEach(g),this.h()},h(){d(e,"class","touch-feedback svelte-slpekr"),f(e,"left",i[5].x+"%"),f(e,"top",i[5].y+"%"),f(e,"opacity",i[4]>.3?.7:.4),f(e,"transform","scale("+(1+i[4])+")")},m(t,s){A(t,e,s)},p(t,s){s&32&&f(e,"left",t[5].x+"%"),s&32&&f(e,"top",t[5].y+"%"),s&16&&f(e,"opacity",t[4]>.3?.7:.4),s&16&&f(e,"transform","scale("+(1+t[4])+")")},d(t){t&&g(e)}}}function ze(i){let e,t,s,l,r,n,c,o;const a=[vt,ht],u=[];function m(h,p){return h[0]?1:0}s=m(i),l=u[s]=a[s](i);let _=i[1]&&we();return{c(){e=D("main"),t=D("div"),l.c(),r=$(),_&&_.c(),this.h()},l(h){e=M(h,"MAIN",{class:!0});var p=T(e);t=M(p,"DIV",{class:!0});var E=T(t);l.l(E),r=j(E),_&&_.l(E),E.forEach(g),p.forEach(g),this.h()},h(){d(t,"class",n="puzzle-container relative p-4 md:p-8 rounded-lg border-0 w-full max-w-2xl "+(i[1]?"solved":"")+" svelte-slpekr"),d(e,"class","relative z-20 max-w-6xl mx-auto px-4 py-4 md:py-12 min-h-screen flex items-center justify-center")},m(h,p){A(h,e,p),k(e,t),u[s].m(t,null),k(t,r),_&&_.m(t,null),o=!0},p(h,p){let E=s;s=m(h),s===E?u[s].p(h,p):(W(),q(u[E],1,1,()=>{u[E]=null}),x(),l=u[s],l?l.p(h,p):(l=u[s]=a[s](h),l.c()),L(l,1),l.m(t,r)),h[1]?_?p&2&&L(_,1):(_=we(),_.c(),L(_,1),_.m(t,null)):_&&(W(),q(_,1,1,()=>{_=null}),x()),(!o||p&2&&n!==(n="puzzle-container relative p-4 md:p-8 rounded-lg border-0 w-full max-w-2xl "+(h[1]?"solved":"")+" svelte-slpekr"))&&d(t,"class",n)},i(h){o||(L(l),L(_),h&&(c||R(()=>{c=N(e,Q,{duration:1e3,delay:300}),c.start()})),o=!0)},o(h){q(l),q(_),o=!1},d(h){h&&g(e),u[s].d(),_&&_.d()}}}function ht(i){let e,t,s,l;return t=new xe({props:{books:i[8],disabled:i[1]}}),t.$on("solve",i[9]),{c(){e=D("div"),K(t.$$.fragment),this.h()},l(r){e=M(r,"DIV",{class:!0});var n=T(e);J(t.$$.fragment,n),n.forEach(g),this.h()},h(){d(e,"class","puzzle-wrapper svelte-slpekr")},m(r,n){A(r,e,n),U(t,e,null),l=!0},p(r,n){const c={};n&2&&(c.disabled=r[1]),t.$set(c)},i(r){l||(L(t.$$.fragment,r),r&&(s||R(()=>{s=N(e,Q,{duration:800}),s.start()})),l=!0)},o(r){q(t.$$.fragment,r),l=!1},d(r){r&&g(e),G(t)}}}function vt(i){let e,t,s,l,r,n,c="A peculiar arrangement of books catches your eye...",o,a,u,m,_,h=i[4]>.5&&i[4]<.8&&Ie();return{c(){e=D("div"),t=D("div"),s=D("div"),l=$(),r=D("div"),n=D("span"),n.textContent=c,o=$(),h&&h.c(),this.h()},l(p){e=M(p,"DIV",{class:!0});var E=T(e);t=M(E,"DIV",{class:!0,role:!0,"aria-label":!0,tabindex:!0});var S=T(t);s=M(S,"DIV",{class:!0,style:!0}),T(s).forEach(g),l=j(S),r=M(S,"DIV",{class:!0,style:!0});var C=T(r);n=M(C,"SPAN",{class:!0,"data-svelte-h":!0}),F(n)!=="svelte-1bbeums"&&(n.textContent=c),C.forEach(g),o=j(S),h&&h.l(S),S.forEach(g),E.forEach(g),this.h()},h(){d(s,"class","bookshelf-highlight svelte-slpekr"),f(s,"opacity",i[4]>.3?i[4]:0),d(n,"class","hint-text svelte-slpekr"),d(r,"class","bookshelf-hint svelte-slpekr"),f(r,"opacity",i[3]?1:0),f(r,"transform","translateY("+(i[3]?0:10)+"px)"),d(t,"class",a="bookshelf-area "+(i[3]?"hovered":"")+" svelte-slpekr"),d(t,"role","button"),d(t,"aria-label","Interact with the bookshelf"),d(t,"tabindex","0"),d(e,"class","bookshelf-interactive svelte-slpekr")},m(p,E){A(p,e,E),k(e,t),k(t,s),k(t,l),k(t,r),k(r,n),k(t,o),h&&h.m(t,null),m||(_=[P(t,"click",i[10]),P(t,"mouseenter",i[11]),P(t,"mouseleave",i[12]),P(t,"keydown",i[13])],m=!0)},p(p,E){E&16&&f(s,"opacity",p[4]>.3?p[4]:0),E&8&&f(r,"opacity",p[3]?1:0),E&8&&f(r,"transform","translateY("+(p[3]?0:10)+"px)"),p[4]>.5&&p[4]<.8?h?E&16&&L(h,1):(h=Ie(),h.c(),L(h,1),h.m(t,null)):h&&(h.d(1),h=null),E&8&&a!==(a="bookshelf-area "+(p[3]?"hovered":"")+" svelte-slpekr")&&d(t,"class",a)},i(p){L(h),p&&(u||R(()=>{u=N(e,Q,{duration:500}),u.start()}))},o:O,d(p){p&&g(e),h&&h.d(),m=!1,oe(_)}}}function Ie(i){let e,t="<span>Hold to examine...</span>",s;return{c(){e=D("div"),e.innerHTML=t,this.h()},l(l){e=M(l,"DIV",{class:!0,"data-svelte-h":!0}),F(e)!=="svelte-zyjqha"&&(e.innerHTML=t),this.h()},h(){d(e,"class","mobile-hint svelte-slpekr")},m(l,r){A(l,e,r)},i(l){l&&(s||R(()=>{s=N(e,Q,{duration:300}),s.start()}))},o:O,d(l){l&&g(e)}}}function we(i){let e,t,s,l;return t=new ot({props:{visible:!0}}),{c(){e=D("div"),K(t.$$.fragment),this.h()},l(r){e=M(r,"DIV",{class:!0});var n=T(e);J(t.$$.fragment,n),n.forEach(g),this.h()},h(){d(e,"class","mt-8")},m(r,n){A(r,e,n),U(t,e,null),l=!0},i(r){l||(L(t.$$.fragment,r),r&&(s||R(()=>{s=N(e,ae,{y:20,duration:800}),s.start()})),l=!0)},o(r){q(t.$$.fragment,r),l=!1},d(r){r&&g(e),G(t)}}}function Ve(i){let e,t='<div class="tutorial-content svelte-slpekr"><span>Explore the library by touching different areas...</span></div>',s,l,r;return{c(){e=D("div"),e.innerHTML=t,this.h()},l(n){e=M(n,"DIV",{class:!0,"data-svelte-h":!0}),F(e)!=="svelte-gegkjq"&&(e.innerHTML=t),this.h()},h(){d(e,"class","mobile-tutorial svelte-slpekr")},m(n,c){A(n,e,c),r=!0},i(n){r||(n&&R(()=>{r&&(l&&l.end(1),s=N(e,Q,{duration:800,delay:1500}),s.start())}),r=!0)},o(n){s&&s.invalidate(),n&&(l=He(e,Q,{duration:500})),r=!1},d(n){n&&g(e),n&&l&&l.end()}}}function mt(i){let e,t,s,l,r,n,c=`<a href="${Pe}/" class="text-parchment hover:text-accent transition-colors duration-300 text-lg">← Return Home</a>`,o,a,u,m,_,h,p,E,S,C,B,V;l=new ut({props:{intensity:i[1]?.18:.12,flickerSpeed:.15}}),a=new re({props:{size:"large",position:{x:50,y:20},intensity:i[1]?1.2:1}}),m=new re({props:{size:"medium",position:{x:15,y:40}}}),h=new re({props:{size:"medium",position:{x:85,y:40}}});let w=!i[0]&&Me(i),b=i[6]&&De(i),v=i[2]&&ze(i),y=i[2]&&!i[0]&&Ve();return{c(){e=D("div"),t=D("div"),s=$(),K(l.$$.fragment),r=$(),n=D("div"),n.innerHTML=c,o=$(),K(a.$$.fragment),u=$(),K(m.$$.fragment),_=$(),K(h.$$.fragment),p=$(),E=D("div"),w&&w.c(),S=$(),b&&b.c(),C=$(),v&&v.c(),B=$(),y&&y.c(),this.h()},l(I){e=M(I,"DIV",{class:!0,style:!0});var z=T(e);t=M(z,"DIV",{class:!0}),T(t).forEach(g),s=j(z),J(l.$$.fragment,z),r=j(z),n=M(z,"DIV",{class:!0,"data-svelte-h":!0}),F(n)!=="svelte-juls2g"&&(n.innerHTML=c),o=j(z),J(a.$$.fragment,z),u=j(z),J(m.$$.fragment,z),_=j(z),J(h.$$.fragment,z),p=j(z),E=M(z,"DIV",{class:!0});var Y=T(E);w&&w.l(Y),Y.forEach(g),S=j(z),b&&b.l(z),C=j(z),v&&v.l(z),B=j(z),y&&y.l(z),z.forEach(g),this.h()},h(){d(t,"class","absolute inset-0 bg-black/50 z-0"),d(n,"class","absolute bottom-8 left-8 z-50"),d(E,"class","absolute inset-0 z-10"),d(e,"class","library-container min-h-screen overflow-hidden relative svelte-slpekr"),f(e,"background-image","url("+pt+")"),f(e,"background-size","cover"),f(e,"background-position","center")},m(I,z){A(I,e,z),k(e,t),k(e,s),U(l,e,null),k(e,r),k(e,n),k(e,o),U(a,e,null),k(e,u),U(m,e,null),k(e,_),U(h,e,null),k(e,p),k(e,E),w&&w.m(E,null),k(e,S),b&&b.m(e,null),k(e,C),v&&v.m(e,null),k(e,B),y&&y.m(e,null),i[14](e),V=!0},p(I,[z]){const Y={};z&2&&(Y.intensity=I[1]?.18:.12),l.$set(Y);const H={};z&2&&(H.intensity=I[1]?1.2:1),a.$set(H),I[0]?w&&(W(),q(w,1,1,()=>{w=null}),x()):w?(w.p(I,z),z&1&&L(w,1)):(w=Me(I),w.c(),L(w,1),w.m(E,null)),I[6]?b?b.p(I,z):(b=De(I),b.c(),b.m(e,C)):b&&(b.d(1),b=null),I[2]?v?(v.p(I,z),z&4&&L(v,1)):(v=ze(I),v.c(),L(v,1),v.m(e,B)):v&&(W(),q(v,1,1,()=>{v=null}),x()),I[2]&&!I[0]?y?z&5&&L(y,1):(y=Ve(),y.c(),L(y,1),y.m(e,null)):y&&(W(),q(y,1,1,()=>{y=null}),x())},i(I){V||(L(l.$$.fragment,I),L(a.$$.fragment,I),L(m.$$.fragment,I),L(h.$$.fragment,I),L(w),L(v),L(y),V=!0)},o(I){q(l.$$.fragment,I),q(a.$$.fragment,I),q(m.$$.fragment,I),q(h.$$.fragment,I),q(w),q(v),q(y),V=!1},d(I){I&&g(e),G(l),G(a),G(m),G(h),w&&w.d(),b&&b.d(),v&&v.d(),y&&y.d(),i[14](null)}}}const pt="https://kxmwcpeuiklblpehddkz.supabase.co/storage/v1/object/public/suspects//library.jpeg";function bt(i,e,t,s){return Math.sqrt(Math.pow(t-i,2)+Math.pow(s-e,2))}function gt(i,e,t){let s=!1,l=!1,r=!1,n=!1,c=!1,o=0;const a=[{id:1,title:"Mortiferous Mushrooms",color:"#8C0000"},{id:2,title:"Aconitum Anthology",color:"#2A003C"},{id:3,title:"Venomous Flora",color:"#39FF14"},{id:4,title:"Dark Rituals",color:"#0A0004"}],u={x:50,y:40,radius:20};let m=0,_={x:0,y:0},h=!1,p;Ce(()=>{X.playAmbient("library-ambience",{volume:.3,fade:!0,fadeIn:3e3}),setTimeout(()=>t(2,r=!0),100),E()}),Ye(()=>{X.stopAmbient("library-ambience",{fade:!0,fadeOut:2e3})});function E(){p&&(p.addEventListener("touchstart",S),p.addEventListener("touchmove",C),p.addEventListener("touchend",B))}function S(H){if(s)return;m=Date.now();const Z=H.touches[0];V(Z),t(6,h=!0),w()}function C(H){if(s)return;const Z=H.touches[0];V(Z),w()}function B(H){if(s)return;const Z=Date.now()-m;t(6,h=!1),Z>300&&o>.7&&v()}function V(H){const Z=p.getBoundingClientRect();t(5,_={x:(H.clientX-Z.left)/Z.width*100,y:(H.clientY-Z.top)/Z.height*100})}function w(){const H=bt(_.x,_.y,u.x,u.y);t(4,o=Math.max(0,1-H/u.radius)),t(3,n=o>.3),o>.7&&navigator.vibrate&&navigator.vibrate(Math.floor(o*30)),o>.5&&!c?(c=!0,X.playEffect("creak",{volume:o*.3})):o<.3&&(c=!1)}async function b(){t(1,l=!0),console.log("Puzzle solved, setting puzzleSolved to:",l),X.playEffect("puzzle-solve",{volume:.5}),Be.update(H=>[...H,{id:"book-puzzle",description:"The arrangement reveals a hidden message about poisonous plants...",discovered_at:new Date().toISOString(),image:"/images/clues/poisoned-page.png"}]),X.playEffect("secret-reveal",{volume:.4,fade:!0,fadeIn:1e3})}function v(){s||(t(0,s=!0),X.playEffect("bookshelf-creak",{volume:.4}))}function y(){!s&&!n&&(t(3,n=!0),X.playEffect("creak",{volume:.2}))}const I=()=>t(3,n=!1),z=H=>H.key==="Enter"&&v();function Y(H){Xe[H?"unshift":"push"](()=>{p=H,t(7,p)})}return[s,l,r,n,o,_,h,p,a,b,v,y,I,z,Y]}class wt extends te{constructor(e){super(),se(this,e,gt,mt,ee,{})}}export{wt as component,It as universal};
